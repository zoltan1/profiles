/*test zoltan*/CREATE OR REPLACE FORCE EDITIONABLE VIEW "LSDEMO"."TESTREPORT" ("R_OBJECT_ID", "LS_PROD_FAMILY_NAME", "AMP_PRODUCT_FAMILY_NAME", "LS_PROD_GLOBAL_NAME", "AMP_GLOBAL_PRODUCT_NAME", "COUNTRY_CODE", "COUNTRY", "FULL_PRODUCT_NAME", "AUTHORISATION_NUMBER", "AUTHORISATION_STATUS_DATE", "VALIDITY_PERIOD_END", "AUTHORISATION_HOLDER_CODE", "AUTHORISATION_HOLDER_NAME", "AUTHORISATION_STATUS_CODE", "AUTHORISATION_STATUS_VALUE", "AMP_ENTITY_STATUS", "REFRESH_DATE", "SORT") AS     SELECT          AMP_SINGLE.R_OBJECT_ID,            AMP_SINGLE.ls_prod_family_name,          PFName.ls_entity_name	                            AS AMP_Product_family_name,                  AMP_REP_SIN.ls_prod_global_name,          GPName.ls_entity_name	                            AS AMP_Global_product_name,          AMP_REP_SIN.ls_ref_country                        AS Country_code,            COUNTRY.ls_entity_name                            AS Country,                  COALESCE(AMP_G_nameEN.ls_prod_name_full, AMP_G_name_First_Row.ls_prod_name_full)  AS Full_product_name,          AMP_REP_SIN.ls_auth_num	                          AS Authorisation_number,           CASE WHEN EXTRACT(YEAR from AMP_REP_SIN.ls_auth_status_date) = 1 THEN null ELSE to_char(AMP_REP_SIN.ls_auth_status_date, 'dd-Mon-yyyy')  END  AS Authorisation_status_date,           CASE WHEN EXTRACT(YEAR from AMP_REP_SIN.ls_auth_valid_to) = 1 THEN null ELSE to_char(AMP_REP_SIN.ls_auth_valid_to, 'dd-Mon-yyyy')  END    AS Validity_period_end,                     AMP_REP_SIN.ls_auth_holder	                      AS Authorisation_holder_code,          ORG_auth_holder.ls_entity_name                    AS Authorisation_holder_name,                  AMP_REP_SIN.ls_auth_status                        AS Authorisation_status_code,           AuthStatus.mp_string_value 	                      AS Authorisation_status_value,              AMP_SINGLE.ls_entity_status                       AS AMP_Entity_status,          to_char(sysdate, 'dd-Mon-yyyy')                   AS Refresh_date,             COUNTRY.ls_entity_name                            AS SORT  FROM     it_ls_entity_s AMP_SINGLE  LEFT JOIN     it_sysobject_s ITSYSOBJ on AMP_SINGLE.r_object_id=ITSYSOBJ.mp_object_id  LEFT JOIN     dm_sysobject_s DMSYSOBJ on AMP_SINGLE.r_object_id=DMSYSOBJ.r_object_id and DMSYSOBJ.i_is_deleted = 0 AND DMSYSOBJ.i_has_folder = 1  LEFT JOIN     it_ls_entity_r AMP_REP_SIN on AMP_SINGLE.r_object_id=AMP_REP_SIN.r_object_id AND AMP_REP_SIN.I_POSITION='-1'  LEFT JOIN     it_ls_entity_r AMP_G_nameEN on AMP_SINGLE.r_object_id=AMP_G_nameEN.r_object_id and AMP_G_nameEN.ls_prod_name_full is not null and upper(AMP_G_nameEN.ls_prod_name_jurisd_lang)='EN'    LEFT JOIN     (    SELECT r_object_id, i_position, ls_prod_name_full, ls_prod_name_jurisd_lang   FROM it_ls_entity_r WHERE ls_prod_name_full is not null and i_position='-1'  ) AMP_G_name_First_Row ON AMP_G_name_First_Row.r_object_id=AMP_SINGLE.r_object_id  LEFT JOIN (        select ls_entity_code, ls_entity_name        from it_ls_entity_s lsents        left join it_sysobject_s itsysobj on lsents.r_object_id=itsysobj.mp_object_id        where itsysobj.mp_profile_id like 'ls_ent_ref_country%' and mp_is_effective = 1       )  COUNTRY on UPPER(AMP_REP_SIN.ls_ref_country)=UPPER(COUNTRY.ls_entity_code)  LEFT JOIN (              SELECT mp_string_id, mp_string_value              FROM  it_mp_config_sp                INNER JOIN dm_sysobject_s ON dm_sysobject_s.r_object_id=it_mp_config_sp.r_object_id and dm_sysobject_s.i_has_folder=1                INNER JOIN it_mp_datasource_r ON it_mp_datasource_r.r_object_id=dm_sysobject_s.r_object_id              WHERE   mp_otype='value_list' and it_mp_config_sp.object_name ='eMPD_auth_status'  ) AuthStatus ON AuthStatus.mp_string_id=AMP_REP_SIN.ls_auth_status       LEFT JOIN (        SELECT ls_entity_code, ls_entity_name        FROM it_ls_entity_s LSentS        LEFT JOIN it_sysobject_s ITSYSOBJ on LSentS.r_object_id=ITSYSOBJ.mp_object_id        WHERE ITSYSOBJ.mp_profile_id ='ls_ent_product_family' and mp_is_effective = 1          ) PFName on PFName.ls_entity_code=AMP_SINGLE.ls_prod_family_name                         LEFT JOIN (        SELECT ls_entity_code, ls_entity_name        FROM it_ls_entity_s LSentS        LEFT JOIN it_sysobject_s ITSYSOBJ on LSentS.r_object_id=ITSYSOBJ.mp_object_id        WHERE ITSYSOBJ.mp_profile_id ='ls_ent_product_global' and mp_is_effective = 1          ) GPName on GPName.ls_entity_code=AMP_REP_SIN.ls_prod_global_name                     LEFT JOIN (        select ls_entity_code, ls_entity_name        from it_ls_entity_s lsents        INNER JOIN dm_sysobject_s DMSYSOBJ on lsents.r_object_id=DMSYSOBJ.r_object_id and DMSYSOBJ.i_is_deleted = 0 AND DMSYSOBJ.i_has_folder = 1        left join it_sysobject_s itsysobj on lsents.r_object_id=itsysobj.mp_object_id        where itsysobj.mp_profile_id='ls_ent_ref_organisation' and ls_entity_status in ('Valid', 'Suspended')    )  ORG_auth_holder on AMP_REP_SIN.ls_auth_holder=ORG_auth_holder.ls_entity_code   WHERE     ITSYSOBJ.MP_PROFILE_ID ='ls_ent_product_auth_simple'     and AuthStatus.mp_string_value like 'Valid%'